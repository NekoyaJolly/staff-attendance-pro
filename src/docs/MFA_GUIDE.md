# 多要素認証 (MFA) システム

## 概要

勤怠管理システムに多要素認証機能を追加しました。これにより、アカウントのセキュリティが大幅に向上します。

## 機能

### サポートする認証方法

1. **TOTPアプリ認証**（推奨）
   - Google Authenticator
   - Authy
   - 1Password
   - その他のTOTP対応アプリ

2. **SMS認証**
   - 電話番号にSMSで認証コードを送信
   - 開発環境では自動的にコードを生成・表示

3. **バックアップコード**
   - 一度のみ使用可能なコード
   - アプリにアクセスできない場合の緊急用

## 使用方法

### MFA設定

1. プロフィール画面の「アカウント設定」セクションから「多要素認証」を選択
2. 認証方法（アプリまたはSMS）を選択
3. 設定手順に従って認証を完了

### ログイン

1. 通常のスタッフID・パスワードでログイン
2. MFAが有効な場合、認証画面が表示
3. 設定した方法で認証コードを入力

## デモユーザー

- **staff001** (田中 太郎): MFA無効
- **creator001** (佐藤 花子): TOTPアプリ認証有効
- **admin001** (管理者 次郎): SMS認証有効

## セキュリティ機能

- TOTP秘密鍵の安全な生成
- バックアップコードの生成・管理
- SMS認証コードの時間制限（5分）
- セキュリティログの記録
- 認証失敗時のログ記録

## 開発者向け情報

### 主要コンポーネント

- `MFAService`: 認証ロジック
- `MFASetupDialog`: 初期設定画面
- `MFAVerification`: ログイン時認証画面
- `AccountSettingsDialog`: プロフィール設定

### セキュリティ考慮事項

- 実際の本番環境では以下を検討してください：
  - TOTP実装の専用ライブラリ使用
  - SMS API（Twilio等）の統合
  - 秘密鍵の安全な保存
  - レート制限の強化

## トラブルシューティング

### よくある問題

1. **認証アプリのコードが受け付けられない**
   - 時刻同期を確認
   - QRコード再スキャンを試行

2. **SMSが届かない**
   - 電話番号を確認
   - 開発環境ではコンソールログを確認

3. **バックアップコードが使えない**
   - 大文字で入力
   - 既に使用済みでないか確認